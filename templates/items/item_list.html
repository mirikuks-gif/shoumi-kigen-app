<!DOCTYPE html>
<html lang="ja">
<head>
    {% load static %}
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="utf-8">
    <link rel="manifest" href="{% static 'manifest.json' %}">
    <meta name="theme-color" content="#2196f3">
    <title>é£Ÿæä¸€è¦§</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/items.css' %}">
</head>
<body>
    <h1>é£Ÿæä¸€è¦§</h1>

    <!-- ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒªãƒ³ã‚¯ -->
    <nav class="nav-links">
        <a href="{% url 'item_add' %}" class="btn btn-main">ğŸ“ æ–°ã—ã„é£Ÿæã‚’ç™»éŒ²</a>
        <a href="{% url 'manual_recipe_search' %}" class="btn btn-main">ğŸ² æ‰‹å‹•ãƒ¬ã‚·ãƒ”æ¤œç´¢</a>
        <a href="{% url 'item_quick_add_list' %}" class="btn btn-sub">ğŸš€ ã‚¯ã‚¤ãƒƒã‚¯è¿½åŠ ãƒªã‚¹ãƒˆ</a>
        <a href="{% url 'home' %}" class="btn btn-sub">ğŸ  ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹</a>
    </nav>

    <!-- ãƒ•ã‚£ãƒ«ã‚¿ãƒ•ã‚©ãƒ¼ãƒ  -->
    <form method="get" class="filter-form">
        <label for="category_select">ã‚«ãƒ†ã‚´ãƒªã§çµã‚Šè¾¼ã‚€:</label>
        <select name="category" id="category_select">
            <option value="">å…¨ã¦ã®ã‚«ãƒ†ã‚´ãƒª</option>
            {% for category in categories %}
                <option value="{{ category.id }}" {% if category.id|stringformat:"s" == selected_category %}selected{% endif %}>
                    {{ category.name }}
                </option>
            {% endfor %}
        </select>
        <button type="submit" class="btn btn-main">ğŸ” çµã‚Šè¾¼ã¿</button>
    </form>
    
    <hr>
    {% if item_list %}
    <form method="post" action="{% url 'item_bulk_operation' %}"> 
        {% csrf_token %}

        <!-- ä¸€æ‹¬æ“ä½œãƒœã‚¿ãƒ³ -->
        <div class="bulk-actions">
            <button type="submit" name="action" value="delete" class="btn btn-red">ğŸ—‘ï¸ ä¸€æ‹¬å‰Šé™¤</button>
            <button type="submit" name="action" value="use" class="btn btn-green">âœ… ä¸€æ‹¬ä½¿ç”¨</button>
        </div>

        <!-- é£Ÿæä¸€è¦§ãƒ†ãƒ¼ãƒ–ãƒ« -->
        <table class="table-list">
            <thead>
                <tr>
                    <th><input type="checkbox" id="select_all"></th> 
                    <th>é£Ÿæå</th>
                    <th>æ•°é‡</th>
                    <th>ä¿å­˜å ´æ‰€</th>
                    <th>è³å‘³æœŸé™</th>
                    <th>ã‚«ãƒ†ã‚´ãƒª</th>
                    <th>é‡‘é¡</th>
                    <th>è³¼å…¥åº—èˆ—</th>
                    <th>æ“ä½œ</th>
                </tr>
            </thead>
            <tbody>
                {% for item in item_list %}
                <tr>
                    <td><input type="checkbox" name="selected_items" value="{{ item.pk }}"></td> 
                    <td>{{ item.name }}</td>
                    <td>{{ item.quantity }}</td>
                    <td>{{ item.location.name }}</td>
                    <td class="{% if item.remaining_days is not None %}
                                {% if item.remaining_days <= 0 %}expired
                                {% elif item.remaining_days <= 3 %}urgent
                                {% elif item.remaining_days <= 7 %}soon
                                {% endif %}
                              {% endif %}">
                        {{ item.expiry_date|date:"Y/m/d" }}
                        {% if item.remaining_days is not None %}
                            <span class="expiry-note">
                            {% if item.remaining_days < 0 %}
                                (æœŸé™åˆ‡ã‚Œ: {{ item.expired_days }}æ—¥å‰)
                            {% else %}
                                (æ®‹ã‚Š {{ item.remaining_days }} æ—¥)
                            {% endif %}
                            </span>
                        {% endif %}
                    </td>
                    <td>{{ item.category.name|default:"-" }}</td>
                    <td>{% if item.price %}{{ item.price }}å††{% else %}-{% endif %}</td>
                    <td>{{ item.store_name|default:"-" }}</td>
                    <td>
                        <div class="action-buttons">
                            <!-- ä¸Šæ®µï¼šä½¿ç”¨ãƒ»ä½¿ã„åˆ‡ã‚Š -->
                            <form method="post" action="{% url 'item_quantity_update' pk=item.pk %}" class="inline-form">
                                {% csrf_token %}
                                <select name="used_amount">
                                    {% for _ in ""|ljust:item.quantity %}
                                        <option value="{{ forloop.counter }}">{{ forloop.counter }}</option>
                                    {% endfor %}
                                </select>
                                <button type="submit" class="btn btn-green">ä½¿ç”¨</button>
                            </form>

                            <form method="post" action="{% url 'item_quantity_update' pk=item.pk %}" class="inline-form">
                                {% csrf_token %}
                                <input type="hidden" name="action" value="full_use"> 
                                <button type="submit" class="btn btn-red">ä½¿ã„åˆ‡ã‚Š</button>
                            </form>

                            <!-- ä¸‹æ®µï¼šç·¨é›†ãƒ»å‰Šé™¤ -->
                            <a href="{% url 'item_edit' pk=item.pk %}" class="btn btn-sub">âœï¸ ç·¨é›†</a>
                            <a href="{% url 'item_delete' pk=item.pk %}" class="btn btn-sub">ğŸ—‘ï¸ å‰Šé™¤</a>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </form>

    <script>
        document.getElementById('select_all').onclick = function(e) {
            var checkboxes = document.getElementsByName('selected_items');
            for (var i = 0; i < checkboxes.length; i++) {
                checkboxes[i].checked = e.target.checked;
            }
        };
    </script>
    {% else %}
    <p>ã¾ã ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹é£Ÿæã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>
    {% endif %}
</body>
</html>
