<!DOCTYPE html>
<html lang="ja">
<head>
    {% load static %}
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="utf-8">
    <link rel="manifest" href="{% static 'manifest.json' %}">
    <meta name="theme-color" content="#2196f3">
    <title>ãƒ¬ã‚·ãƒ”æ¤œç´¢</title>
    <link rel="stylesheet" href="{% static 'css/recipes.css' %}">
</head>
<body>
    <h1>æ¶ˆè²»ææ¡ˆã®çŒ®ç«‹ ğŸ³</h1>
    <p>
        <a href="{% url 'item_list' %}">é£Ÿæä¸€è¦§ã«æˆ»ã‚‹</a>
    </p>
    <hr>

    <!-- æ‰‹å‹•ãƒ¬ã‚·ãƒ”æ¤œç´¢ãƒ•ã‚©ãƒ¼ãƒ  -->
    <section class="manual-search">
        <h2>æ‰‹å‹•ãƒ¬ã‚·ãƒ”æ¤œç´¢</h2>
        <form method="get" action="{% url 'manual_recipe_search' %}">
            <label for="ingredients">
                é£Ÿæã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆä¾‹ï¼šé¶ã‚€ã­è‚‰, ç‰ã­ã, åµï¼‰:
            </label><br>
            <input type="text" id="ingredients" name="ingredients" size="60"
                value="{{ keyword|default:'' }}"
                placeholder="ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šã§å…¥åŠ›" required>
            <button type="submit">ãƒ¬ã‚·ãƒ”æ¤œç´¢</button>
        </form>
<hr>


<h2>åœ¨åº«ã‹ã‚‰æ¤œç´¢</h2>
<form method="get" action="https://www.kurashiru.com/search" target="_blank">
    <label for="auto_ingredients">
        åœ¨åº«ã®é£Ÿæã‚’è‡ªå‹•å…¥åŠ›ã—ã¦ã„ã¾ã™ï¼ˆç·¨é›†ã‚‚ã§ãã¾ã™ï¼‰:
    </label><br>
    <input type="text" id="auto_ingredients" name="query" size="60"
        value="{{ auto_query }}"
        placeholder="åœ¨åº«ã®é£ŸæãŒè‡ªå‹•ã§å…¥ã‚Šã¾ã™">
    <button type="submit">åœ¨åº«ã§æ¤œç´¢</button>
</form>
    </section>
<hr>
<br>

<!-- æŠ˜ã‚ŠãŸãŸã¿ãƒœã‚¿ãƒ³ -->
<button class="toggle-btn" onclick="toggleQuickSearch()">â–¼ ã‚¯ã‚¤ãƒƒã‚¯æ¤œç´¢ï¼ˆã‚¿ãƒƒãƒ—ã§é–‹ãï¼‰</button>

<!-- æŠ˜ã‚ŠãŸãŸã¿å†…å®¹ -->
<div id="quick-search-box" style="display:none; margin-top:10px;">
    {% for item in item_list %}
        <form method="get" action="https://www.kurashiru.com/search" target="_blank" style="display:inline;">
            <input type="hidden" name="query" value="{{ item.name }}">
            <button type="submit" class="quick-btn">
                {{ item.name }}ã§æ¤œç´¢
            </button>
        </form>
    {% endfor %}
</div>

<script>
function toggleQuickSearch() {
    const box = document.getElementById("quick-search-box");
    const btn = document.querySelector(".toggle-btn");

    if (box.style.display === "none") {
        box.style.display = "block";
        btn.textContent = "â–² ã‚¯ã‚¤ãƒƒã‚¯æ¤œç´¢ï¼ˆã‚¿ãƒƒãƒ—ã§é–‰ã˜ã‚‹ï¼‰";
    } else {
        box.style.display = "none";
        btn.textContent = "â–¼ ã‚¯ã‚¤ãƒƒã‚¯æ¤œç´¢ï¼ˆã‚¿ãƒƒãƒ—ã§é–‹ãï¼‰";
    }
}
</script>

    <!-- åœ¨åº«é£Ÿæä¸€è¦§ -->
    <section class="stock-section">
        <h2>ç¾åœ¨ã®åœ¨åº«é£Ÿæ</h2>
        <div class="stock-container">
            {% if item_list %}
                <ul class="stock-list">
                    {% for item in item_list %}
                    <li class="{{ item.status_class }}">
                        {{ item.name }}
                        ({{ item.quantity }}å€‹, {{ item.location.name }},
                        æœŸé™: {{ item.expiration_date }},
                        æ®‹ã‚Š: {{ item.days_left }}æ—¥)
                    </li>
                    {% endfor %}
                </ul>
            {% else %}
                <p>åœ¨åº«é£Ÿæã¯ã¾ã ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚</p>
            {% endif %}
        </div>
    </section>

    <hr>

    <!-- æ¤œç´¢çµæœ -->
    <section class="search-results">
        {% if recipes %}
            <h2>æ¤œç´¢çµæœ ({{ keyword }} ã‚’åˆ©ç”¨)</h2>
            <div class="recipe-container">
                {% for recipe in recipes %}
                    <div class="recipe-card">
                        <h4>
                            <a href="{{ recipe.url }}" target="_blank">{{ recipe.title }}</a>
                        </h4>
                        {% if recipe.image_url %}
                            <img src="{{ recipe.image_url }}" alt="{{ recipe.title }}">
                        {% endif %}
                    </div>
                {% endfor %}
            </div>
        {% else %}
            {% if keyword %}
                <p>ã€Œ{{ keyword }}ã€ã«ä¸€è‡´ã™ã‚‹ãƒ¬ã‚·ãƒ”ã¯è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚</p>
            {% endif %}
        {% endif %}
    </section>

    <!-- Service Worker ç™»éŒ² -->
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register("{% static 'js/service-worker.js' %}")
                .then(reg => console.log('Service Worker registered', reg))
                .catch(err => console.log('Service Worker registration failed', err));
        }
    </script>
</body>
</html>
