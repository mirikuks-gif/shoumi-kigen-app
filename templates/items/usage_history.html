<!DOCTYPE html>
<html lang="ja">
<head>
    {% load static %}
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="utf-8">
    <link rel="manifest" href="{% static 'manifest.json' %}">
    <meta name="theme-color" content="#2196f3">
    <title>é£Ÿæä½¿ç”¨å±¥æ­´</title>
    <style>
        .history-day {
            margin-top: 25px;
            padding: 10px;
            background-color: #e0f2fe; /* æ—¥ä»˜ã®èƒŒæ™¯è‰² */
            border-bottom: 2px solid #93c5fd;
            font-size: 1.2em;
            font-weight: bold;
        }
        .history-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px dashed #ccc;
        }
        .item-name {
            font-weight: bold;
            flex: 2; /* å¹…ã‚’åºƒã’ã‚‹ */
        }
        .item-detail {
            flex: 1;
            text-align: right;
            margin-left: 10px;
        }
        .used-quantity {
            color: #ef4444; /* ä½¿ç”¨æ•°é‡ã‚’èµ¤ã */
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>é£Ÿæä½¿ç”¨å±¥æ­´</h1>
    <h2>ğŸ“Š æ”¯å‡ºã‚µãƒãƒªãƒ¼</h2>

    <div style="display: flex; gap: 20px; margin-bottom: 30px;">
        
        <div style="flex: 1; border: 1px solid #ccc; padding: 15px; border-radius: 5px;">
            <h2>ğŸ’° æœˆåˆ¥åˆè¨ˆæ”¯å‡º</h2>
            {% if monthly_spend %}
                <table border="1" style="border-collapse: collapse; margin-bottom: 20px;">
                    <thead>
                        <tr>
                            <th>å¹´æœˆ</th>
                            <th>åˆè¨ˆæ”¯å‡ºé¡</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in monthly_spend %}
                        <tr>
                            <td>{{ item.month|date:"Yå¹´mæœˆ" }}</td>
                            <td>{{ item.total_price|floatformat:0 }} å††</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            {% else %}
                <p>æœˆåˆ¥æ”¯å‡ºã®å±¥æ­´ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>
            {% endif %}
        </div> <div style="flex: 1; border: 1px solid #ccc; padding: 15px; border-radius: 5px;">
            <h3>ã‚«ãƒ†ã‚´ãƒªåˆ¥æ”¯å‡ºåˆè¨ˆ</h3>
            {% if category_spend %}
                {% for item in category_spend %}
                    <p style="margin: 5px 0;">
                        <b>{{ item.category_name|default:"ä¸æ˜" }}</b>: 
                        {% if item.total_price %}{{ item.total_price|floatformat:"0" }}å††{% else %}0å††{% endif %}
                    </p>
                {% endfor %}
            {% else %}
                <p>ã‚«ãƒ†ã‚´ãƒªåˆ¥æ”¯å‡ºãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</p>
            {% endif %}
        </div> </div> <hr>
    <p><a href="{% url 'home' %}">ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹</a></p>
    
    {% if history_list %}
        {% with current_day="" %}
        {% for history in history_list %}
            {% comment %} æ—¥ä»˜ãŒå¤‰ã‚ã£ãŸã‚‰æ–°ã—ã„ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’è¡¨ç¤º {% endcomment %}
            {% if history.used_at|date:"Yå¹´mæœˆdæ—¥" != current_day %}
                <div class="history-day">
                    {{ history.used_at|date:"Yå¹´mæœˆdæ—¥" }}
                </div>
                {% with history.used_at|date:"Yå¹´mæœˆdæ—¥" as current_day %}
                {% endwith %}
            {% endif %}

            <div class="history-item">
                <div class="item-name">
                    {{ history.item_name }}
                    <span style="font-size: 0.8em; color: #666;">
                        ï¼ˆ{{ history.category_name|default:"ã‚«ãƒ†ã‚´ãƒªä¸æ˜" }}ï¼‰
                    </span>
                </div>
                <div class="item-detail">
    <span class="used-quantity">- {{ history.quantity_used }} å€‹</span>
    
    <span style="font-size: 0.8em; color: #333; display: block;"> 
        {% if history.price_at_usage %}{{ history.price_at_usage }}å††{% endif %}
        ({{ history.store_name_at_usage|default:"åº—èˆ—ä¸æ˜" }})
    </span>
    <span style="font-size: 0.8em; color: #999;">
        ({{ history.used_at|date:"H:i" }} ä½¿ç”¨)
    </span>
</div>
            </div>
        {% endfor %}
        {% endwith %}
    {% else %}
    <p>ã¾ã ä½¿ç”¨å±¥æ­´ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>
    {% endif %}

</body>
</html>